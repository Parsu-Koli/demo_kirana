@model List<KiranaStoreUI.Models.ViewModels.SaleProfitVM>

@{
    ViewData["Title"] = "Profit By Date Range";
    decimal totalProfit = Model?.Sum(x => x.Profit) ?? 0m;
}

<div class="container mt-5">

    <h2 class="mb-4 text-success fw-bold"><i class="bi bi-currency-rupee"></i> Profit By Date Range</h2>

    <!-- ---------------- Date Range Picker Card ---------------- -->
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-success text-white fw-bold">
            <i class="bi bi-calendar-range"></i> Select Date Range
        </div>
        <div class="card-body">
            <form method="get" class="row g-3 align-items-end">
                <div class="col-md-3">
                    <label for="startDate" class="form-label fw-semibold">Start Date</label>
                    <input type="date" id="startDate" name="startDate" class="form-control"
                           value="@ViewBag.StartDate" required />
                </div>
                <div class="col-md-3">
                    <label for="endDate" class="form-label fw-semibold">End Date</label>
                    <input type="date" id="endDate" name="endDate" class="form-control"
                           value="@ViewBag.EndDate" required />
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-success w-100">
                        <i class="bi bi-search"></i> Get Profit
                    </button>
                </div>

                @* Total Profit Card next to button *@
                @if (Model != null && Model.Any())
                {
                    <div class="col-md-3">
                        <div class="card text-center border-success shadow-sm">
                            <div class="card-body">
                                <h6 class="card-title text-success fw-bold">Total Profit</h6>
                                <span class="fs-4 fw-bold text-success">₹ @totalProfit</span>
                            </div>
                        </div>
                    </div>
                }
            </form>
        </div>
    </div>

    <!-- ---------------- Sales Table ---------------- -->
    @if (Model != null && Model.Any())
    {
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-success text-white fw-bold">
                <i class="bi bi-table"></i> Sales Details
            </div>
            <div class="card-body table-responsive">
                <table class="table table-striped table-hover align-middle">
                    <thead class="table-success text-dark">
                        <tr>
                            <th>Invoice</th>
                            <th>Sale Date</th>
                            <th>Purchase Price (₹)</th>
                            <th>Selling Price (₹)</th>
                            <th>Net Amount (₹)</th>
                            <th>Profit (₹)</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var sale in Model)
                        {
                            <tr>
                                <td class="fw-semibold">@sale.InvoiceNumber</td>
                                <td>@sale.SaleDate.ToString("dd-MMM-yyyy")</td>
                                <td>@sale.PurchasePrice</td>
                                <td>@sale.SellingPrice</td>
                                <td>@sale.Total</td>
                                <td> @sale.Profit</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }
    else
    {
        <div class="alert alert-warning shadow-sm text-center">
            <i class="bi bi-exclamation-triangle-fill"></i>
            No sales found for the selected date range.
        </div>
    }
</div>
